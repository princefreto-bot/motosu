<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Motosu Agencies</title>
  <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
  <style>
    .toast{position:fixed;top:20px;right:20px;padding:15px 25px;border-radius:8px;color:white;z-index:9999;animation:slideIn .3s ease}
    @keyframes slideIn{from{transform:translateX(100%);opacity:0}to{transform:translateX(0);opacity:1}}
    .toast-success{background:#10b981}.toast-error{background:#ef4444}.toast-info{background:#3b82f6}
    .tab-active{border-bottom:3px solid #3b82f6;color:#3b82f6;font-weight:600}
    .card{background:white;border-radius:12px;box-shadow:0 2px 10px rgba(0,0,0,0.1);padding:20px}
    .btn-primary{background:#3b82f6;color:white;padding:12px 24px;border-radius:8px;font-weight:600;transition:all .2s}
    .btn-primary:hover{background:#2563eb}
    .btn-success{background:#10b981;color:white;padding:12px 24px;border-radius:8px;font-weight:600}
    .btn-success:hover{background:#059669}
    .btn-orange{background:#f97316;color:white;padding:12px 24px;border-radius:8px;font-weight:600}
    .btn-orange:hover{background:#ea580c}
    .btn-danger{background:#ef4444;color:white;padding:10px 20px;border-radius:8px}
    .btn-danger:hover{background:#dc2626}
    .input{width:100%;padding:12px;border:1px solid #e5e7eb;border-radius:8px;margin-bottom:12px}
    .input:focus{outline:none;border-color:#3b82f6;box-shadow:0 0 0 3px rgba(59,130,246,0.1)}
    .stat-blue{background:linear-gradient(135deg,#3b82f6,#1d4ed8);color:white}
    .stat-orange{background:linear-gradient(135deg,#f97316,#ea580c);color:white}
    .stat-green{background:linear-gradient(135deg,#10b981,#059669);color:white}
    .modal{position:fixed;inset:0;background:rgba(0,0,0,0.6);display:flex;align-items:center;justify-content:center;z-index:1000;padding:16px}
    .modal-content{background:white;border-radius:16px;padding:24px;max-width:500px;width:100%;max-height:90vh;overflow-y:auto}
    .option-btn{display:block;width:100%;padding:12px 16px;margin:8px 0;background:#f3f4f6;border:2px solid transparent;border-radius:8px;cursor:pointer;transition:all .2s;text-align:left}
    .option-btn:hover{background:#e5e7eb}
    .option-btn.selected{background:#3b82f6;color:white;border-color:#1d4ed8}
    .check-item{display:flex;align-items:center;padding:12px 16px;margin:8px 0;background:#f3f4f6;border:2px solid transparent;border-radius:8px;cursor:pointer;transition:all .2s}
    .check-item:hover{background:#e5e7eb}
    .check-item.selected{background:#10b981;color:white;border-color:#059669}
    .category-select{padding:8px 12px;border:1px solid #d1d5db;border-radius:6px;background:white}
    .progress-bar{height:8px;background:#e5e7eb;border-radius:4px;overflow:hidden}
    .progress-fill{height:100%;background:#10b981;transition:width .3s}
  </style>
</head>
<body class="bg-gray-100 min-h-screen">
  <div id="app"></div>
  <div id="modal"></div>

  <script>
    // √âtat global
    let state = {
      currentUser: null,
      currentPage: 'login',
      config: { paymentNumbers: [], subscriptionAmount: 4000 },
      tasks: [],
      currentTask: null,
      referrals: null,
      withdrawals: [],
      adminData: { pending: [], users: [], withdrawals: [], tasks: [], payments: [], stats: {}, config: {} }
    };

    // Utilitaires
    const $ = (sel) => document.querySelector(sel);
    const $$ = (sel) => document.querySelectorAll(sel);
    const api = async (url, method = 'GET', data = null) => {
      try {
        const opts = { method, headers: { 'Content-Type': 'application/json' } };
        if (data) opts.body = JSON.stringify(data);
        const res = await fetch(url, opts);
        return res.json();
      } catch (e) {
        console.error('API Error:', e);
        return { error: 'Erreur de connexion' };
      }
    };

    const toast = (msg, type = 'info') => {
      const div = document.createElement('div');
      div.className = `toast toast-${type}`;
      div.textContent = msg;
      document.body.appendChild(div);
      setTimeout(() => div.remove(), 4000);
    };

    // Pages
    const pages = {
      login: () => `
        <div class="min-h-screen flex items-center justify-center p-4 bg-gradient-to-br from-blue-500 to-purple-600">
          <div class="card w-full max-w-md">
            <div class="text-center mb-6">
              <h1 class="text-3xl font-bold text-blue-600">üöÄ Motosu Agencies</h1>
              <p class="text-gray-500 mt-2">Plateforme de gains en ligne</p>
            </div>
            <form id="loginForm">
              <input type="email" class="input" placeholder="Email" id="loginEmail" required>
              <input type="password" class="input" placeholder="Mot de passe" id="loginPassword" required>
              <button type="submit" class="btn-primary w-full">Se connecter</button>
            </form>
            <p class="text-center mt-4 text-gray-600">
              Pas de compte ? <a href="#" onclick="navigate('register')" class="text-blue-600 font-semibold">S'inscrire</a>
            </p>
            <hr class="my-4">
            <button onclick="navigate('subscription')" class="w-full btn-orange mb-3">üí≥ Voir les offres d'abonnement</button>
            <button onclick="navigate('about')" class="w-full text-gray-500 border border-gray-300 rounded-lg py-3">√Ä propos de nous</button>
          </div>
        </div>
      `,

      register: () => `
        <div class="min-h-screen flex items-center justify-center p-4 bg-gradient-to-br from-green-500 to-blue-600">
          <div class="card w-full max-w-md">
            <h1 class="text-2xl font-bold text-center mb-6 text-blue-600">Cr√©er un compte</h1>
            <form id="registerForm">
              <input type="text" class="input" placeholder="Nom complet" id="regName" required>
              <input type="email" class="input" placeholder="Email" id="regEmail" required>
              <input type="tel" class="input" placeholder="T√©l√©phone (+225 XX XX XX XX XX)" id="regPhone" required>
              <input type="password" class="input" placeholder="Mot de passe (min. 6 caract√®res)" id="regPassword" minlength="6" required>
              <input type="text" class="input" placeholder="Code parrain (optionnel)" id="regReferral" value="${localStorage.getItem('referralCode') || ''}">
              <button type="submit" class="btn-success w-full">S'inscrire gratuitement</button>
            </form>
            <p class="text-center mt-4 text-gray-600">
              D√©j√† un compte ? <a href="#" onclick="navigate('login')" class="text-blue-600 font-semibold">Se connecter</a>
            </p>
          </div>
        </div>
      `,

      subscription: () => `
        <div class="min-h-screen p-4 bg-gray-100">
          <div class="card max-w-2xl mx-auto">
            <button onclick="navigate('login')" class="text-gray-500 mb-4">‚Üê Retour</button>
            <h1 class="text-2xl font-bold mb-4 text-center text-blue-600">üí≥ Abonnement Motosu</h1>
            
            <div class="stat-orange rounded-xl p-6 text-center mb-6">
              <p class="text-lg opacity-90">Frais d'abonnement unique</p>
              <p class="text-4xl font-bold">${state.config.subscriptionAmount || 4000} FCFA</p>
            </div>

            <div class="mb-6">
              <h2 class="font-bold text-lg mb-3">‚úÖ Ce que vous obtenez :</h2>
              <ul class="space-y-3">
                <li class="flex items-start gap-3 p-3 bg-green-50 rounded-lg">
                  <span class="text-green-500 text-xl">‚úì</span>
                  <div>
                    <p class="font-semibold">Acc√®s illimit√© aux micro-t√¢ches</p>
                    <p class="text-sm text-gray-500">Gagnez jusqu'√† 755 FCFA par jour en compl√©tant des t√¢ches</p>
                  </div>
                </li>
                <li class="flex items-start gap-3 p-3 bg-blue-50 rounded-lg">
                  <span class="text-blue-500 text-xl">‚úì</span>
                  <div>
                    <p class="font-semibold">Programme de parrainage 3 niveaux</p>
                    <p class="text-sm text-gray-500">500 FCFA (N1) + 200 FCFA (N2) + 100 FCFA (N3) par filleul</p>
                  </div>
                </li>
                <li class="flex items-start gap-3 p-3 bg-orange-50 rounded-lg">
                  <span class="text-orange-500 text-xl">‚úì</span>
                  <div>
                    <p class="font-semibold">Retraits rapides</p>
                    <p class="text-sm text-gray-500">Mobile Money d√®s 1000 FCFA, Crypto d√®s 10000 FCFA</p>
                  </div>
                </li>
              </ul>
            </div>

            <div class="bg-blue-50 p-4 rounded-lg mb-6">
              <h3 class="font-bold text-blue-600 mb-2">üí° Comment s'abonner ?</h3>
              <ol class="text-sm text-gray-700 space-y-2">
                <li>1. Inscrivez-vous gratuitement</li>
                <li>2. Effectuez le d√©p√¥t de ${state.config.subscriptionAmount || 4000} FCFA via Mobile Money</li>
                <li>3. Envoyez la capture d'√©cran du paiement</li>
                <li>4. Votre compte est activ√© sous 24h</li>
              </ol>
            </div>

            <button onclick="navigate('register')" class="btn-primary w-full mb-3">Cr√©er un compte maintenant</button>
          </div>
        </div>
      `,

      about: () => `
        <div class="min-h-screen p-4 bg-gray-100">
          <div class="card max-w-2xl mx-auto">
            <button onclick="navigate('login')" class="text-gray-500 mb-4">‚Üê Retour</button>
            <h1 class="text-2xl font-bold mb-4 text-blue-600">√Ä propos de Motosu Agencies</h1>
            <div class="prose">
              <p class="text-gray-700 leading-relaxed mb-4">
                Motosu Agencies est une plateforme innovante d√©di√©e √† l'accompagnement des jeunes entrepreneurs et professionnels francophones en Afrique. Notre mission est de cr√©er un environnement s√©curis√© et accessible o√π chacun peut d√©velopper son r√©seau, apprendre √† travers des contenus interactifs et b√©n√©ficier d'opportunit√©s de croissance progressive.
              </p>
              <p class="text-gray-700 leading-relaxed mb-4">
                Nous croyons √† l'importance de l'engagement et de la pers√©v√©rance : chaque action sur notre plateforme contribue √† la progression personnelle et professionnelle de nos utilisateurs.
              </p>
              <p class="text-gray-700 leading-relaxed mb-6">
                Notre √©quipe, bas√©e en Afrique et en Europe, veille √† ce que l'exp√©rience utilisateur soit simple, s√©curis√©e et adapt√©e aux besoins d'une communaut√© mobile-first. Rejoignez-nous et d√©couvrez comment votre engagement peut vous permettre de progresser.
              </p>
            </div>
          </div>
        </div>
      `,

      pending: () => `
        <div class="min-h-screen p-4 bg-gray-100">
          <div class="card max-w-lg mx-auto">
            <div class="text-center mb-6">
              <div class="text-6xl mb-4">‚è≥</div>
              <h1 class="text-xl font-bold text-orange-600">Compte de recharge - Compte inactif</h1>
              <p class="text-gray-600 mt-2">Veuillez vous abonner. Utilisez le num√©ro <strong>${state.currentUser?.phone || ''}</strong> pour le d√©p√¥t.</p>
            </div>
            
            <div class="bg-orange-50 border border-orange-200 p-4 rounded-lg mb-4">
              <p class="font-bold text-orange-800 text-center text-lg">${state.config.subscriptionAmount || 4000} FCFA</p>
            </div>

            <div class="mb-6">
              <h3 class="font-bold mb-3">üì± Num√©ros de paiement :</h3>
              <div class="space-y-2">
                ${(state.config.paymentNumbers || []).map(p => `
                  <div class="flex justify-between items-center p-3 bg-gray-50 rounded-lg">
                    <div>
                      <p class="font-semibold">${p.operator}</p>
                      <p class="text-sm text-gray-500">${p.name}</p>
                    </div>
                    <div class="text-right">
                      <p class="font-mono font-bold text-blue-600">${p.number}</p>
                      <button onclick="copyNumber('${p.number}')" class="text-xs text-blue-500">üìã Copier</button>
                    </div>
                  </div>
                `).join('')}
              </div>
            </div>

            <div class="bg-blue-50 p-4 rounded-lg mb-6">
              <h3 class="font-bold text-blue-600 mb-2">üìù Apr√®s votre paiement :</h3>
              <p class="text-sm text-gray-700">Envoyez une capture d'√©cran de la confirmation de paiement pour activer votre compte.</p>
            </div>

            <button onclick="openPaymentProof()" class="btn-orange w-full mb-3">üì§ Envoyer ma preuve de paiement</button>
            
            ${state.currentUser?.status === 'pending_payment' ? `
              <div class="bg-green-50 border border-green-200 p-3 rounded-lg text-center mb-3">
                <p class="text-green-700 text-sm">‚úì Preuve envoy√©e - En attente de validation</p>
              </div>
            ` : ''}
            
            <button onclick="logout()" class="w-full text-red-500 py-2">D√©connexion</button>
          </div>
        </div>
      `,

      dashboard: () => `
        <div class="min-h-screen bg-gray-100">
          ${renderNav()}
          <div class="p-4 max-w-4xl mx-auto">
            <h1 class="text-xl font-bold mb-4">Bonjour, ${state.currentUser?.name?.split(' ')[0]} üëã</h1>
            
            <div class="grid grid-cols-2 gap-4 mb-6">
              <div class="stat-blue rounded-xl p-4 text-center">
                <p class="text-sm opacity-80">Solde Mis</p>
                <p class="text-2xl font-bold">4 000 FCFA</p>
              </div>
              <div class="stat-orange rounded-xl p-4 text-center">
                <p class="text-sm opacity-80">Gains Accumul√©s</p>
                <p class="text-2xl font-bold">${state.currentUser?.earnings || 0} FCFA</p>
              </div>
            </div>

            <div class="card mb-4">
              <h2 class="font-bold mb-3">üìä Vos statistiques</h2>
              <div class="grid grid-cols-3 gap-3 text-center">
                <div class="bg-blue-50 p-3 rounded-lg">
                  <p class="text-2xl font-bold text-blue-600">${state.referrals?.level1?.users?.length || 0}</p>
                  <p class="text-xs text-gray-500">Filleuls N1</p>
                </div>
                <div class="bg-green-50 p-3 rounded-lg">
                  <p class="text-2xl font-bold text-green-600">${state.referrals?.level2?.users?.length || 0}</p>
                  <p class="text-xs text-gray-500">Filleuls N2</p>
                </div>
                <div class="bg-purple-50 p-3 rounded-lg">
                  <p class="text-2xl font-bold text-purple-600">${state.currentUser?.completedTasks?.length || 0}</p>
                  <p class="text-xs text-gray-500">T√¢ches faites</p>
                </div>
              </div>
            </div>

            <div class="card mb-4">
              <h2 class="font-bold mb-3">üîó Votre lien de parrainage</h2>
              <div class="bg-gray-100 p-3 rounded-lg">
                <p class="text-xs text-gray-500 mb-1">Votre code :</p>
                <div class="flex items-center justify-between">
                  <code class="text-lg font-bold text-blue-600">${state.currentUser?.referralCode}</code>
                  <button onclick="copyReferral()" class="btn-primary text-sm py-2 px-4">üìã Copier le lien</button>
                </div>
              </div>
              <p class="text-xs text-gray-500 mt-2">Gagnez 500 FCFA pour chaque filleul qui s'abonne!</p>
            </div>

            <div class="card">
              <h2 class="font-bold mb-3">üí° Actions rapides</h2>
              <div class="grid grid-cols-2 gap-3">
                <button onclick="navigate('tasks')" class="bg-green-100 text-green-700 p-4 rounded-lg text-center hover:bg-green-200 transition">
                  <p class="text-2xl mb-1">üìã</p>
                  <p class="font-semibold text-sm">Faire des t√¢ches</p>
                </button>
                <button onclick="navigate('referrals')" class="bg-blue-100 text-blue-700 p-4 rounded-lg text-center hover:bg-blue-200 transition">
                  <p class="text-2xl mb-1">üë•</p>
                  <p class="font-semibold text-sm">Parrainer</p>
                </button>
              </div>
            </div>
          </div>
        </div>
      `,

      tasks: () => {
        const completedToday = state.currentUser?.tasksCompletedToday?.length || 0;
        const availableTasks = state.tasks.filter(t => !state.currentUser?.completedTasks?.includes(t.id));
        
        return `
          <div class="min-h-screen bg-gray-100">
            ${renderNav()}
            <div class="p-4 max-w-4xl mx-auto">
              <h1 class="text-xl font-bold mb-2">üìã Micro-T√¢ches</h1>
              <p class="text-sm text-gray-500 mb-4">Compl√©tez des t√¢ches et gagnez de l'argent r√©el!</p>
              
              <div class="bg-white rounded-lg p-4 mb-4 shadow-sm">
                <div class="flex justify-between items-center mb-2">
                  <span class="font-semibold">Aujourd'hui</span>
                  <span class="text-blue-600 font-bold">${completedToday}/10 t√¢ches</span>
                </div>
                <div class="progress-bar">
                  <div class="progress-fill" style="width: ${completedToday * 10}%"></div>
                </div>
                <p class="text-xs text-gray-500 mt-2">${10 - completedToday} t√¢ches restantes aujourd'hui</p>
              </div>
              
              ${availableTasks.length === 0 ? `
                <div class="card text-center py-8">
                  <p class="text-4xl mb-3">üéâ</p>
                  <p class="font-bold text-green-600">Toutes les t√¢ches sont compl√©t√©es!</p>
                  <p class="text-gray-500 text-sm">Revenez plus tard pour de nouvelles t√¢ches.</p>
                </div>
              ` : `
                <div class="space-y-3">
                  ${availableTasks.map(task => `
                    <div class="card hover:shadow-lg transition">
                      <div class="flex items-start justify-between">
                        <div class="flex-1">
                          <span class="text-xs px-2 py-1 rounded-full ${getTaskTypeColor(task.type)}">${getTaskTypeLabel(task.type)}</span>
                          <h3 class="font-semibold mt-2">${task.title}</h3>
                          <p class="text-sm text-gray-500 mt-1">${task.description}</p>
                        </div>
                        <div class="text-right ml-4">
                          <p class="font-bold text-green-600 text-lg">+${task.reward} FCFA</p>
                        </div>
                      </div>
                      <button onclick="openTask('${task.id}')" class="btn-success w-full mt-4 text-sm py-3">
                        Commencer cette t√¢che
                      </button>
                    </div>
                  `).join('')}
                </div>
              `}
              
              <div class="mt-6">
                <h3 class="font-bold mb-3 text-gray-600">‚úì T√¢ches compl√©t√©es (${state.currentUser?.completedTasks?.length || 0})</h3>
                <div class="space-y-2">
                  ${state.tasks.filter(t => state.currentUser?.completedTasks?.includes(t.id)).map(task => `
                    <div class="bg-green-50 border border-green-200 rounded-lg p-3 flex justify-between items-center">
                      <div>
                        <p class="font-semibold text-green-700">${task.title}</p>
                        <p class="text-xs text-green-600">+${task.reward} FCFA gagn√©s</p>
                      </div>
                      <span class="text-green-500 text-xl">‚úì</span>
                    </div>
                  `).join('')}
                </div>
              </div>
            </div>
          </div>
        `;
      },

      referrals: () => `
        <div class="min-h-screen bg-gray-100">
          ${renderNav()}
          <div class="p-4 max-w-4xl mx-auto">
            <h1 class="text-xl font-bold mb-4">üë• Programme Parrainage</h1>
            
            <div class="card mb-4">
              <h2 class="font-bold mb-3">üîó Votre lien de parrainage</h2>
              <div class="bg-gradient-to-r from-blue-500 to-purple-500 p-4 rounded-lg text-white text-center">
                <p class="text-sm opacity-80 mb-1">Votre code unique</p>
                <p class="text-2xl font-bold mb-3">${state.currentUser?.referralCode}</p>
                <button onclick="copyReferral()" class="bg-white text-blue-600 px-6 py-2 rounded-full font-semibold text-sm">
                  üìã Copier le lien complet
                </button>
              </div>
            </div>

            <div class="bg-orange-50 border border-orange-200 p-4 rounded-lg mb-4">
              <p class="text-sm text-orange-800">
                <strong>üí° Astuce :</strong> Partagez votre lien sur WhatsApp, Facebook, TikTok et gagnez pour chaque inscription valid√©e!
              </p>
            </div>

            <div class="grid gap-4">
              <div class="card border-l-4 border-green-500">
                <div class="flex justify-between items-center">
                  <div>
                    <h3 class="font-bold text-green-600">ü•á Niveau 1 (Filleuls directs)</h3>
                    <p class="text-sm text-gray-500">500 FCFA par filleul valid√©</p>
                  </div>
                  <div class="text-right">
                    <p class="text-3xl font-bold">${state.referrals?.level1?.users?.length || 0}</p>
                    <p class="text-green-600 font-bold">${state.referrals?.level1?.total || 0} FCFA</p>
                  </div>
                </div>
                ${(state.referrals?.level1?.users?.length > 0) ? `
                  <div class="mt-3 pt-3 border-t">
                    <div class="flex flex-wrap gap-2">
                      ${state.referrals.level1.users.map(u => `
                        <span class="text-xs px-2 py-1 rounded-full ${u.status === 'validated' ? 'bg-green-100 text-green-700' : 'bg-yellow-100 text-yellow-700'}">
                          ${u.name} ${u.status === 'validated' ? '‚úì' : '‚è≥'}
                        </span>
                      `).join('')}
                    </div>
                  </div>
                ` : ''}
              </div>

              <div class="card border-l-4 border-blue-500">
                <div class="flex justify-between items-center">
                  <div>
                    <h3 class="font-bold text-blue-600">ü•à Niveau 2</h3>
                    <p class="text-sm text-gray-500">200 FCFA par filleul valid√©</p>
                  </div>
                  <div class="text-right">
                    <p class="text-3xl font-bold">${state.referrals?.level2?.users?.length || 0}</p>
                    <p class="text-blue-600 font-bold">${state.referrals?.level2?.total || 0} FCFA</p>
                  </div>
                </div>
              </div>

              <div class="card border-l-4 border-purple-500">
                <div class="flex justify-between items-center">
                  <div>
                    <h3 class="font-bold text-purple-600">ü•â Niveau 3</h3>
                    <p class="text-sm text-gray-500">100 FCFA par filleul valid√©</p>
                  </div>
                  <div class="text-right">
                    <p class="text-3xl font-bold">${state.referrals?.level3?.users?.length || 0}</p>
                    <p class="text-purple-600 font-bold">${state.referrals?.level3?.total || 0} FCFA</p>
                  </div>
                </div>
              </div>
            </div>

            <div class="card mt-4 stat-orange">
              <div class="text-center">
                <p class="text-sm opacity-80">Total des gains parrainage</p>
                <p class="text-3xl font-bold">
                  ${(state.referrals?.level1?.total || 0) + (state.referrals?.level2?.total || 0) + (state.referrals?.level3?.total || 0)} FCFA
                </p>
              </div>
            </div>
          </div>
        </div>
      `,

      withdraw: () => `
        <div class="min-h-screen bg-gray-100">
          ${renderNav()}
          <div class="p-4 max-w-4xl mx-auto">
            <h1 class="text-xl font-bold mb-4">üí∞ Retraits</h1>
            
            <div class="card mb-4">
              <div class="stat-orange rounded-lg p-4 text-center mb-4">
                <p class="text-sm opacity-80">Solde disponible</p>
                <p class="text-3xl font-bold">${state.currentUser?.earnings || 0} FCFA</p>
              </div>

              <form id="withdrawForm">
                <label class="block text-sm font-medium text-gray-700 mb-2">M√©thode de retrait</label>
                <select id="withdrawMethod" class="input" onchange="updateWithdrawMin()">
                  <option value="orange">Orange Money (min 1000 FCFA)</option>
                  <option value="mtn">MTN Mobile Money (min 1000 FCFA)</option>
                  <option value="wave">Wave (min 1000 FCFA)</option>
                  <option value="moov">Moov Money (min 1000 FCFA)</option>
                  <option value="crypto">Crypto USDT TRC20 (min 10000 FCFA)</option>
                </select>
                
                <label class="block text-sm font-medium text-gray-700 mb-2">Montant √† retirer</label>
                <input type="number" id="withdrawAmount" class="input" placeholder="Montant en FCFA" min="1000" required>
                
                <label class="block text-sm font-medium text-gray-700 mb-2">Num√©ro ou Adresse de r√©ception</label>
                <input type="text" id="withdrawAccount" class="input" placeholder="+225 XX XX XX XX XX ou adresse USDT" required>
                
                <label class="block text-sm font-medium text-gray-700 mb-2">Nom du titulaire</label>
                <input type="text" id="withdrawName" class="input" placeholder="Nom complet du compte" value="${state.currentUser?.name || ''}">
                
                <button type="submit" class="btn-orange w-full">Demander le retrait</button>
              </form>
              
              <p class="text-xs text-gray-500 text-center mt-3">‚è±Ô∏è Traitement sous 24-48h ouvr√©es</p>
            </div>

            <div class="card">
              <h2 class="font-bold mb-3">üìú Historique des retraits</h2>
              ${state.withdrawals.length === 0 ? 
                '<p class="text-gray-500 text-sm text-center py-4">Aucun retrait effectu√©</p>' : `
                <div class="space-y-2">
                  ${state.withdrawals.map(w => `
                    <div class="flex justify-between items-center p-3 bg-gray-50 rounded-lg">
                      <div>
                        <p class="font-semibold">${w.amount} FCFA</p>
                        <p class="text-xs text-gray-500">${w.method} ‚Ä¢ ${new Date(w.createdAt).toLocaleDateString('fr-FR')}</p>
                      </div>
                      <span class="px-3 py-1 rounded-full text-xs font-semibold ${getStatusColor(w.status)}">${getStatusLabel(w.status)}</span>
                    </div>
                  `).join('')}
                </div>
              `}
            </div>
          </div>
        </div>
      `,

      admin: () => `
        <div class="min-h-screen bg-gray-100">
          <div class="bg-gradient-to-r from-blue-600 to-purple-600 text-white p-4">
            <div class="max-w-4xl mx-auto flex justify-between items-center">
              <h1 class="text-xl font-bold">‚öôÔ∏è Admin Panel</h1>
              <button onclick="logout()" class="bg-white/20 px-4 py-2 rounded-lg text-sm">D√©connexion</button>
            </div>
          </div>
          
          <div class="p-4 max-w-4xl mx-auto">
            <div class="flex gap-2 overflow-x-auto mb-4 pb-2">
              <button onclick="setAdminTab('stats')" class="admin-tab px-4 py-2 bg-white rounded-lg text-sm whitespace-nowrap" id="tab-stats">üìä Stats</button>
              <button onclick="setAdminTab('pending')" class="admin-tab px-4 py-2 bg-white rounded-lg text-sm whitespace-nowrap" id="tab-pending">‚è≥ En attente</button>
              <button onclick="setAdminTab('users')" class="admin-tab px-4 py-2 bg-white rounded-lg text-sm whitespace-nowrap" id="tab-users">üë• Utilisateurs</button>
              <button onclick="setAdminTab('withdrawals')" class="admin-tab px-4 py-2 bg-white rounded-lg text-sm whitespace-nowrap" id="tab-withdrawals">üí∏ Retraits</button>
              <button onclick="setAdminTab('config')" class="admin-tab px-4 py-2 bg-white rounded-lg text-sm whitespace-nowrap" id="tab-config">‚öôÔ∏è Config</button>
            </div>
            
            <div id="adminContent"></div>
          </div>
        </div>
      `
    };

    // Navigation
    function renderNav() {
      return `
        <div class="bg-white shadow-sm sticky top-0 z-50">
          <div class="max-w-4xl mx-auto px-4 py-3 flex items-center justify-between">
            <h1 class="text-lg font-bold text-blue-600">üöÄ Motosu</h1>
            <div class="flex items-center gap-3">
              <span class="text-sm text-gray-500">${state.currentUser?.earnings || 0} FCFA</span>
              <button onclick="logout()" class="text-red-500 text-sm">Quitter</button>
            </div>
          </div>
          <div class="flex border-t">
            <button onclick="navigate('dashboard')" class="flex-1 py-3 text-xs text-center ${state.currentPage === 'dashboard' ? 'tab-active' : 'text-gray-500'}">üè† Accueil</button>
            <button onclick="navigate('tasks')" class="flex-1 py-3 text-xs text-center ${state.currentPage === 'tasks' ? 'tab-active' : 'text-gray-500'}">üìã T√¢ches</button>
            <button onclick="navigate('referrals')" class="flex-1 py-3 text-xs text-center ${state.currentPage === 'referrals' ? 'tab-active' : 'text-gray-500'}">üë• Parrainage</button>
            <button onclick="navigate('withdraw')" class="flex-1 py-3 text-xs text-center ${state.currentPage === 'withdraw' ? 'tab-active' : 'text-gray-500'}">üí∞ Retrait</button>
          </div>
        </div>
      `;
    }

    function getTaskTypeColor(type) {
      const colors = {
        sondage: 'bg-blue-100 text-blue-600',
        verification: 'bg-yellow-100 text-yellow-600',
        classification: 'bg-purple-100 text-purple-600',
        transcription: 'bg-green-100 text-green-600'
      };
      return colors[type] || 'bg-gray-100 text-gray-600';
    }

    function getTaskTypeLabel(type) {
      const labels = {
        sondage: 'üìä Sondage',
        verification: '‚úÖ V√©rification',
        classification: 'üìÅ Classification',
        transcription: '‚úçÔ∏è Transcription'
      };
      return labels[type] || type;
    }

    function getStatusColor(status) {
      const colors = {
        pending: 'bg-yellow-100 text-yellow-700',
        pending_payment: 'bg-orange-100 text-orange-700',
        approved: 'bg-green-100 text-green-700',
        rejected: 'bg-red-100 text-red-700',
        validated: 'bg-green-100 text-green-700'
      };
      return colors[status] || 'bg-gray-100 text-gray-600';
    }

    function getStatusLabel(status) {
      const labels = {
        pending: 'En attente',
        pending_payment: 'Paiement √† v√©rifier',
        approved: 'Approuv√©',
        rejected: 'Refus√©',
        validated: 'Valid√©'
      };
      return labels[status] || status;
    }

    async function navigate(page) {
      state.currentPage = page;
      
      if (state.currentUser && state.currentUser.status === 'validated') {
        if (['dashboard', 'referrals'].includes(page)) {
          state.referrals = await api(`/api/referrals/${state.currentUser.id}`);
        }
        if (page === 'tasks') {
          state.tasks = await api('/api/tasks');
        }
        if (page === 'withdraw') {
          state.withdrawals = await api(`/api/withdrawals/user/${state.currentUser.id}`);
        }
      }
      
      render();
    }

    function render() {
      const app = $('#app');
      if (pages[state.currentPage]) {
        app.innerHTML = pages[state.currentPage]();
        attachEventListeners();
      }
    }

    function attachEventListeners() {
      const loginForm = $('#loginForm');
      if (loginForm) {
        loginForm.onsubmit = async (e) => {
          e.preventDefault();
          const res = await api('/api/login', 'POST', {
            email: $('#loginEmail').value,
            password: $('#loginPassword').value
          });
          if (res.error) {
            toast(res.error, 'error');
          } else {
            state.currentUser = res.user;
            localStorage.setItem('userId', res.user.id);
            if (res.user.isAdmin) {
              navigate('admin');
            } else if (res.user.status === 'validated') {
              navigate('dashboard');
            } else {
              navigate('pending');
            }
            toast('Connexion r√©ussie!', 'success');
          }
        };
      }

      const registerForm = $('#registerForm');
      if (registerForm) {
        registerForm.onsubmit = async (e) => {
          e.preventDefault();
          const res = await api('/api/register', 'POST', {
            name: $('#regName').value,
            email: $('#regEmail').value,
            phone: $('#regPhone').value,
            password: $('#regPassword').value,
            referralCode: $('#regReferral').value
          });
          if (res.error) {
            toast(res.error, 'error');
          } else {
            state.currentUser = res.user;
            localStorage.setItem('userId', res.user.id);
            localStorage.removeItem('referralCode');
            navigate('pending');
            toast('Inscription r√©ussie! Veuillez activer votre compte.', 'success');
          }
        };
      }

      const withdrawForm = $('#withdrawForm');
      if (withdrawForm) {
        withdrawForm.onsubmit = async (e) => {
          e.preventDefault();
          const method = $('#withdrawMethod').value;
          const amount = parseInt($('#withdrawAmount').value);
          
          const res = await api('/api/withdraw', 'POST', {
            userId: state.currentUser.id,
            amount,
            method,
            accountNumber: $('#withdrawAccount').value,
            accountName: $('#withdrawName').value
          });
          
          if (res.error) {
            toast(res.error, 'error');
          } else {
            toast(res.message, 'success');
            state.currentUser = await api(`/api/user/${state.currentUser.id}`);
            navigate('withdraw');
          }
        };
      }
      
      if (state.currentPage === 'admin') {
        setAdminTab('stats');
      }
    }

    // T√¢ches
    function openTask(taskId) {
      const task = state.tasks.find(t => t.id === taskId);
      if (!task) return;
      
      state.currentTask = task;
      const modal = $('#modal');
      modal.innerHTML = renderTaskModal(task);
    }

    function renderTaskModal(task) {
      let content = '';
      
      if (task.type === 'sondage') {
        content = `
          <div class="space-y-6" id="surveyQuestions">
            ${task.content.questions.map((q, i) => `
              <div class="question-block">
                <p class="font-semibold mb-3 text-gray-800">${i + 1}. ${q.question}</p>
                <div class="space-y-2">
                  ${q.options.map((opt, j) => `
                    <button type="button" class="option-btn" data-question="${i}" data-value="${opt}" onclick="selectSurveyOption(this)">
                      ${opt}
                    </button>
                  `).join('')}
                </div>
              </div>
            `).join('')}
          </div>
        `;
      } else if (task.type === 'verification') {
        content = `
          <div class="mb-4 p-3 bg-blue-50 rounded-lg">
            <p class="text-sm text-blue-800">${task.content.instruction}</p>
          </div>
          <div class="space-y-2" id="verificationItems">
            ${task.content.items.map((item, i) => `
              <div class="check-item" data-index="${i}" onclick="toggleVerificationItem(this)">
                <span class="flex-1">${item.text}</span>
                <span class="checkmark hidden">‚úì</span>
              </div>
            `).join('')}
          </div>
        `;
      } else if (task.type === 'classification') {
        content = `
          <div class="mb-4 p-3 bg-purple-50 rounded-lg">
            <p class="text-sm text-purple-800">${task.content.instruction}</p>
          </div>
          <div class="space-y-3" id="classificationItems">
            ${task.content.items.map((item, i) => `
              <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                <span class="font-medium flex-1">${item.name}</span>
                <select class="category-select" data-index="${i}">
                  <option value="">Choisir...</option>
                  ${task.content.categories.map(cat => `<option value="${cat}">${cat}</option>`).join('')}
                </select>
              </div>
            `).join('')}
          </div>
        `;
      } else if (task.type === 'transcription') {
        content = `
          <div class="mb-4 p-4 bg-blue-50 rounded-lg border-l-4 border-blue-500">
            <p class="text-sm text-gray-500 mb-2">üìÑ Texte √† recopier exactement :</p>
            <p class="text-gray-800 italic leading-relaxed">"${task.content.textToTranscribe}"</p>
          </div>
          <textarea id="transcriptionText" class="input h-32" placeholder="Recopiez le texte ci-dessus exactement..."></textarea>
          <p class="text-xs text-gray-500">Pr√©cision minimum requise : ${task.content.minAccuracy}%</p>
        `;
      }

      return `
        <div class="modal" onclick="closeModal(event)">
          <div class="modal-content" onclick="event.stopPropagation()">
            <div class="flex justify-between items-start mb-4">
              <div>
                <span class="text-xs px-2 py-1 rounded-full ${getTaskTypeColor(task.type)}">${getTaskTypeLabel(task.type)}</span>
                <h2 class="text-lg font-bold mt-2">${task.title}</h2>
                <p class="text-sm text-gray-500">${task.description}</p>
              </div>
              <button onclick="closeModal()" class="text-gray-400 hover:text-gray-600 text-2xl">&times;</button>
            </div>
            
            <div class="mb-6 max-h-96 overflow-y-auto">
              ${content}
            </div>
            
            <div class="flex gap-3 sticky bottom-0 bg-white pt-3 border-t">
              <button onclick="closeModal()" class="flex-1 bg-gray-200 text-gray-700 py-3 rounded-lg font-semibold">Annuler</button>
              <button onclick="submitTask('${task.id}')" class="flex-1 btn-success py-3">Valider (+${task.reward} FCFA)</button>
            </div>
          </div>
        </div>
      `;
    }

    function selectSurveyOption(btn) {
      const question = btn.dataset.question;
      $$(`[data-question="${question}"]`).forEach(el => el.classList.remove('selected'));
      btn.classList.add('selected');
    }

    function toggleVerificationItem(item) {
      item.classList.toggle('selected');
      item.querySelector('.checkmark').classList.toggle('hidden');
    }

    function closeModal(event) {
      if (event && event.target !== event.currentTarget) return;
      $('#modal').innerHTML = '';
      state.currentTask = null;
    }

    async function submitTask(taskId) {
      const task = state.currentTask;
      if (!task) return;
      
      let answers;
      
      if (task.type === 'sondage') {
        answers = [];
        task.content.questions.forEach((_, i) => {
          const selected = $(`.option-btn.selected[data-question="${i}"]`);
          answers.push(selected ? selected.dataset.value : null);
        });
      } else if (task.type === 'verification') {
        answers = [];
        $$('.check-item.selected').forEach(item => {
          answers.push(parseInt(item.dataset.index));
        });
      } else if (task.type === 'classification') {
        answers = {};
        $$('.category-select').forEach(sel => {
          answers[sel.dataset.index] = sel.value;
        });
      } else if (task.type === 'transcription') {
        answers = $('#transcriptionText').value;
      }
      
      const res = await api(`/api/tasks/${taskId}/complete`, 'POST', {
        userId: state.currentUser.id,
        answers
      });
      
      if (res.error) {
        toast(res.error, 'error');
      } else {
        toast(res.message, 'success');
        closeModal();
        state.currentUser = await api(`/api/user/${state.currentUser.id}`);
        navigate('tasks');
      }
    }

    // Preuve de paiement
    function openPaymentProof() {
      const modal = $('#modal');
      modal.innerHTML = `
        <div class="modal" onclick="closeModal(event)">
          <div class="modal-content" onclick="event.stopPropagation()">
            <h2 class="text-lg font-bold mb-4">üì§ Envoyer la preuve de paiement</h2>
            
            <form id="paymentProofForm">
              <label class="block text-sm font-medium text-gray-700 mb-2">Capture d'√©cran du paiement *</label>
              <input type="file" id="proofScreenshot" accept="image/*" class="input" required>
              
              <label class="block text-sm font-medium text-gray-700 mb-2">ID Transaction (optionnel)</label>
              <input type="text" id="proofTransactionId" class="input" placeholder="Ex: TXN123456789">
              
              <label class="block text-sm font-medium text-gray-700 mb-2">Num√©ro utilis√© pour le paiement</label>
              <input type="text" id="proofPhone" class="input" value="${state.currentUser?.phone || ''}" placeholder="+225 XX XX XX XX XX">
              
              <div class="flex gap-3 mt-4">
                <button type="button" onclick="closeModal()" class="flex-1 bg-gray-200 text-gray-700 py-3 rounded-lg font-semibold">Annuler</button>
                <button type="submit" class="flex-1 btn-orange py-3">Envoyer</button>
              </div>
            </form>
          </div>
        </div>
      `;
      
      $('#paymentProofForm').onsubmit = async (e) => {
        e.preventDefault();
        const file = $('#proofScreenshot').files[0];
        if (!file) {
          toast('Veuillez ajouter une capture d\'√©cran', 'error');
          return;
        }
        
        const reader = new FileReader();
        reader.onload = async () => {
          const res = await api('/api/payment/proof', 'POST', {
            userId: state.currentUser.id,
            screenshot: reader.result,
            transactionId: $('#proofTransactionId').value,
            phoneUsed: $('#proofPhone').value
          });
          
          if (res.error) {
            toast(res.error, 'error');
          } else {
            toast(res.message, 'success');
            closeModal();
            state.currentUser = await api(`/api/user/${state.currentUser.id}`);
            navigate('pending');
          }
        };
        reader.readAsDataURL(file);
      };
    }

    function copyNumber(number) {
      navigator.clipboard.writeText(number);
      toast('Num√©ro copi√©: ' + number, 'success');
    }

    function copyReferral() {
      const link = `${window.location.origin}?ref=${state.currentUser.referralCode}`;
      navigator.clipboard.writeText(link);
      toast('Lien de parrainage copi√©!', 'success');
    }

    function logout() {
      state.currentUser = null;
      localStorage.removeItem('userId');
      navigate('login');
      toast('D√©connexion r√©ussie', 'info');
    }

    // Admin
    let currentAdminTab = 'stats';

    async function setAdminTab(tab) {
      currentAdminTab = tab;
      $$('.admin-tab').forEach(el => el.classList.remove('bg-blue-600', 'text-white'));
      $(`#tab-${tab}`)?.classList.add('bg-blue-600', 'text-white');
      
      const content = $('#adminContent');
      if (!content) return;
      
      if (tab === 'stats') {
        state.adminData.stats = await api('/api/admin/stats');
        content.innerHTML = renderAdminStats();
      } else if (tab === 'pending') {
        state.adminData.pending = await api('/api/admin/pending');
        content.innerHTML = renderAdminPending();
      } else if (tab === 'users') {
        state.adminData.users = await api('/api/admin/users');
        content.innerHTML = renderAdminUsers();
      } else if (tab === 'withdrawals') {
        state.adminData.withdrawals = await api('/api/admin/withdrawals');
        content.innerHTML = renderAdminWithdrawals();
      } else if (tab === 'config') {
        state.adminData.config = await api('/api/admin/config');
        content.innerHTML = renderAdminConfig();
      }
    }

    function renderAdminStats() {
      const s = state.adminData.stats;
      return `
        <div class="grid grid-cols-2 gap-4">
          <div class="card text-center">
            <p class="text-3xl font-bold text-blue-600">${s.totalUsers || 0}</p>
            <p class="text-gray-500 text-sm">Total utilisateurs</p>
          </div>
          <div class="card text-center">
            <p class="text-3xl font-bold text-green-600">${s.validatedUsers || 0}</p>
            <p class="text-gray-500 text-sm">Comptes actifs</p>
          </div>
          <div class="card text-center">
            <p class="text-3xl font-bold text-yellow-600">${s.pendingUsers || 0}</p>
            <p class="text-gray-500 text-sm">En attente</p>
          </div>
          <div class="card text-center">
            <p class="text-3xl font-bold text-purple-600">${s.pendingWithdrawals || 0}</p>
            <p class="text-gray-500 text-sm">Retraits en attente</p>
          </div>
          <div class="card text-center col-span-2">
            <p class="text-3xl font-bold text-orange-600">${s.totalWithdrawals || 0} FCFA</p>
            <p class="text-gray-500 text-sm">Total retraits approuv√©s</p>
          </div>
        </div>
      `;
    }

    function renderAdminPending() {
      if (state.adminData.pending.length === 0) {
        return '<div class="card text-center text-gray-500 py-8">‚úì Aucun compte en attente</div>';
      }
      return state.adminData.pending.map(u => `
        <div class="card mb-3">
          <div class="flex flex-col sm:flex-row sm:justify-between sm:items-start gap-3">
            <div class="flex-1">
              <p class="font-bold text-lg">${u.name}</p>
              <p class="text-sm text-gray-500">${u.email}</p>
              <p class="text-sm text-gray-500">${u.phone}</p>
              <span class="inline-block mt-1 px-2 py-1 text-xs rounded-full ${getStatusColor(u.status)}">${getStatusLabel(u.status)}</span>
              <p class="text-xs text-gray-400 mt-1">Inscrit le ${new Date(u.createdAt).toLocaleDateString('fr-FR')}</p>
              ${u.paymentProof ? `
                <div class="mt-3 p-3 bg-orange-50 rounded-lg">
                  <p class="text-sm font-semibold text-orange-700 mb-2">üì∏ Preuve de paiement :</p>
                  <img src="${u.paymentProof.screenshot}" class="w-full max-w-xs rounded-lg border cursor-pointer" onclick="window.open('${u.paymentProof.screenshot}')">
                  ${u.paymentProof.transactionId ? `<p class="text-xs text-gray-500 mt-1">ID: ${u.paymentProof.transactionId}</p>` : ''}
                  <p class="text-xs text-gray-500">Tel: ${u.paymentProof.phoneUsed}</p>
                </div>
              ` : ''}
            </div>
            <div class="flex sm:flex-col gap-2">
              <button onclick="validateUser('${u.id}')" class="btn-success text-sm px-4 py-2 flex-1">‚úì Valider</button>
              <button onclick="rejectUser('${u.id}')" class="btn-danger text-sm px-4 py-2 flex-1">‚úó Refuser</button>
            </div>
          </div>
        </div>
      `).join('');
    }

    function renderAdminUsers() {
      return `
        <div class="card">
          <p class="text-sm text-gray-500 mb-3">Total: ${state.adminData.users.length} utilisateurs</p>
          <div class="space-y-2">
            ${state.adminData.users.map(u => `
              <div class="flex justify-between items-center p-3 bg-gray-50 rounded-lg">
                <div>
                  <p class="font-semibold">${u.name} ${u.isAdmin ? 'üëë' : ''}</p>
                  <p class="text-xs text-gray-500">${u.email}</p>
                  <p class="text-xs text-gray-500">${u.earnings} FCFA gagn√©s ‚Ä¢ ${u.completedTasks?.length || 0} t√¢ches</p>
                </div>
                <span class="px-2 py-1 rounded-full text-xs font-semibold ${getStatusColor(u.status)}">${getStatusLabel(u.status)}</span>
              </div>
            `).join('')}
          </div>
        </div>
      `;
    }

    function renderAdminWithdrawals() {
      if (state.adminData.withdrawals.length === 0) {
        return '<div class="card text-center text-gray-500 py-8">Aucune demande de retrait</div>';
      }
      return state.adminData.withdrawals.map(w => `
        <div class="card mb-3">
          <div class="flex flex-col sm:flex-row sm:justify-between gap-3">
            <div>
              <p class="font-bold text-xl text-orange-600">${w.amount} FCFA</p>
              <p class="font-semibold">${w.userName}</p>
              <p class="text-sm text-gray-500">${w.method.toUpperCase()}</p>
              <p class="text-sm text-gray-600">üì± ${w.accountNumber}</p>
              <p class="text-sm text-gray-500">Nom: ${w.accountName}</p>
              <p class="text-xs text-gray-400">${new Date(w.createdAt).toLocaleDateString('fr-FR')}</p>
            </div>
            <div class="flex flex-col gap-2 items-end">
              <span class="px-3 py-1 rounded-full text-xs font-semibold ${getStatusColor(w.status)}">${getStatusLabel(w.status)}</span>
              ${w.status === 'pending' ? `
                <button onclick="approveWithdraw('${w.id}')" class="btn-success text-sm px-4 py-2">‚úì Approuver</button>
                <button onclick="rejectWithdraw('${w.id}')" class="btn-danger text-sm px-4 py-2">‚úó Refuser</button>
              ` : ''}
            </div>
          </div>
        </div>
      `).join('');
    }

    function renderAdminConfig() {
      const config = state.adminData.config;
      return `
        <div class="card">
          <h2 class="font-bold text-lg mb-4">üì± Num√©ros de paiement</h2>
          <div id="paymentNumbersList">
            ${(config.paymentNumbers || []).map((p, i) => `
              <div class="flex items-center gap-2 mb-3 p-3 bg-gray-50 rounded-lg">
                <div class="flex-1 grid grid-cols-3 gap-2">
                  <input type="text" class="input mb-0 text-sm" value="${p.operator}" placeholder="Op√©rateur" id="op-${i}">
                  <input type="text" class="input mb-0 text-sm" value="${p.number}" placeholder="Num√©ro" id="num-${i}">
                  <input type="text" class="input mb-0 text-sm" value="${p.name}" placeholder="Nom" id="name-${i}">
                </div>
                <button onclick="removePaymentNumber(${i})" class="text-red-500 text-xl px-2">√ó</button>
              </div>
            `).join('')}
          </div>
          <button onclick="addPaymentNumber()" class="text-blue-600 text-sm font-semibold mb-4">+ Ajouter un num√©ro</button>
          <button onclick="savePaymentNumbers()" class="btn-primary w-full">Enregistrer les num√©ros</button>
        </div>
      `;
    }

    function addPaymentNumber() {
      state.adminData.config.paymentNumbers.push({ operator: '', number: '', name: '' });
      $('#adminContent').innerHTML = renderAdminConfig();
    }

    function removePaymentNumber(index) {
      state.adminData.config.paymentNumbers.splice(index, 1);
      $('#adminContent').innerHTML = renderAdminConfig();
    }

    async function savePaymentNumbers() {
      const numbers = [];
      state.adminData.config.paymentNumbers.forEach((_, i) => {
        const op = $(`#op-${i}`)?.value;
        const num = $(`#num-${i}`)?.value;
        const name = $(`#name-${i}`)?.value;
        if (op && num) {
          numbers.push({ operator: op, number: num, name: name || '' });
        }
      });
      
      const res = await api('/api/admin/config/payment-numbers', 'POST', { paymentNumbers: numbers });
      if (res.success) {
        toast('Num√©ros enregistr√©s!', 'success');
        state.config.paymentNumbers = numbers;
      } else {
        toast('Erreur lors de l\'enregistrement', 'error');
      }
    }

    async function validateUser(userId) {
      await api(`/api/admin/validate/${userId}`, 'POST');
      toast('Compte valid√©! Commissions vers√©es.', 'success');
      setAdminTab('pending');
    }

    async function rejectUser(userId) {
      await api(`/api/admin/reject/${userId}`, 'POST');
      toast('Compte refus√©', 'info');
      setAdminTab('pending');
    }

    async function approveWithdraw(id) {
      await api(`/api/admin/withdraw/approve/${id}`, 'POST');
      toast('Retrait approuv√©!', 'success');
      setAdminTab('withdrawals');
    }

    async function rejectWithdraw(id) {
      await api(`/api/admin/withdraw/reject/${id}`, 'POST');
      toast('Retrait refus√©, montant rembours√©', 'info');
      setAdminTab('withdrawals');
    }

    // Init
    async function init() {
      // Charger la configuration
      state.config = await api('/api/config');
      
      // V√©rifier code parrain dans l'URL
      const urlParams = new URLSearchParams(window.location.search);
      const ref = urlParams.get('ref');
      if (ref) {
        localStorage.setItem('referralCode', ref);
        toast('Code parrain enregistr√©: ' + ref, 'success');
        window.history.replaceState({}, '', '/');
      }

      // V√©rifier session existante
      const userId = localStorage.getItem('userId');
      if (userId) {
        try {
          const user = await api(`/api/user/${userId}`);
          if (user && !user.error) {
            state.currentUser = user;
            if (user.isAdmin) {
              navigate('admin');
            } else if (user.status === 'validated') {
              navigate('dashboard');
            } else {
              navigate('pending');
            }
            return;
          }
        } catch (e) {}
      }
      navigate('login');
    }

    init();
  </script>
</body>
</html>